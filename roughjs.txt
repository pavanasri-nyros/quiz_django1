const options = document.querySelector(".options").children;
const answerTrackerContainer = document.querySelector(".answers-tracker");
const questionNumberSpan=document.querySelector(".question-num-value");
const totalQuestionSpan=document.querySelector(".total-question");
const correctAnswerSpan = document.querySelector(".correct-answers");
const totalQuestionSpan2 = document.querySelector(".total-questions2");
const percentage = document.querySelector(".percentage");


var question = document.querySelector(".question");
const op1 = document.querySelector(".option1");
const op2 = document.querySelector(".option2");
const op3 = document.querySelector(".option3");
const op4 = document.querySelector(".option4");
const answer = document.querySelector(".answer");
let questionIndex;
let index = 1;
var questions = [];
let myArray =[];
let myArr = [];
let score = 0;

  $.ajax({
    url: 'http://127.0.0.1:8000/api/?format=json',
    type:'GET',
    async:true,
    dataType: "json", 
    success: function(data)
     { 
        questions = data ;
     }
  });


    // var questions;
    // fetch('http://127.0.0.1:8000/api/?format=json')
    // .then(res => res.json())
    // .then(data => questions = data)
    // .then(() => console.log(questions))

totalQuestionSpan.innerHTML = questions.length;
function load(){
    questionNumberSpan.innerHTML = index + 1;
    question.innerHTML = questions[questionIndex].question;
    op1.innerHTML = questions[questionIndex].option1;
    op2.innerHTML = questions[questionIndex].option2;
    op3.innerHTML = questions[questionIndex].option3;
    op4.innerHTML = questions[questionIndex].option4;
    index++;
  }

  function check(element){
    //console.log(element.id);
    if(element.id == questions[questionIndex].answer){
      //correct
      element.classList.add("correct");
      updateAnswerTracker("correct")
      score++;

    }
    else{
      //wrong
      element.classList.add("wrong");
      updateAnswerTracker("wrong")
    }
    
    disabledOptions()
  }

  function disabledOptions(){
    for(let i =0;i<options.length;i++){
      options[i].classList.add("disabled");
      if(options[i].id== questions[questionIndex].answer){
        options[i].classList.add("correct");
      }
    }
  }

  function enableOptions(){
    for(let i =0;i<options.length;i++){
      options[i].classList.remove("disabled","correct","wrong");
     
    }
  }

  function validate(){
    if(!options[0].classList.contains("disabled")){
      alert("pleases select one option")

    }
    else{
      randomQuestion();
      enableOptions();
    }

  }
  function next(){
    validate();
  }

  function randomQuestion(){
    let randomNumber = Math.floor(Math.random()*question.length);
    let hitDuplicate=0;
        if(index == question.length){
          quizOver();
                }
        else{
          if(myArray.length>0){
            for(let i=0;i<myArray.length; i++){
              if(myArray[i]==randomNumber){
                hitDuplicate=1;
                break;
              }

            }
            if(hitDuplicate==1){
              randomQuestion();
            }
            else{
              questionIndex=randomNumber;
              load();
            }

          }
          if(myArray.length==0){
            questionIndex=randomNumber;
            load();
            myarr.push(questionIndex);
          }
        myArray.push(randomNumber);
        
        }
  }

  function answerTracker(){
    for(let i = 0; i<questions.length;i++)
    {
      const div = document.createElement("div")
      answerTrackerContainer.appendChild(div);

    }

  }
  function updateAnswerTracker(classNam){
    answerTrackerContainer.children[index-1].classList.add(classNam)

  }
  function quizOver(){
    document.querySelector(".quiz-over").classList.add("show");
    correctAnswerSpan.innerHTML=score;
    totalQuestionSpan2.innerHTML = questions.length;
    percentage.innerHTML=(score/questions.length)*100 + "%";

  }
  
  function tryAgain(){
    window.location.reload();
  }
  window.load = function(){
      randomQuestion()
      answerTracker()
  }
-------------------------------------------------------------------------

const questionNumberSpan=document.querySelector(".question-num-value");
const totalNumberSpan = document.querySelector(".total-question");
const totalQuestionSpan=document.querySelector(".total-question");

const answer = document.querySelector(".answer");
let questionIndex = 0;
let index = 1;
var questions = [];
  $.ajax({
    url: 'http://127.0.0.1:8002/api/?format=json',
    type:'GET',
    async:true,
    dataType: "json",
    success: function(data)
     {
        questions = data ;
        load();
     }
  });
function load(){
  const question = document.querySelector(".question");
const op1 = document.querySelector(".option1");
const op2 = document.querySelector(".option2");
const op3 = document.querySelector(".option3");
const op4 = document.querySelector(".option4");
    //questionIndex = 0;
    question.innerHTML = questions[questionIndex].question;
    op1.innerHTML = questions[questionIndex].option1;
    op2.innerHTML = questions[questionIndex].option2;
    op3.innerHTML = questions[questionIndex].option3;
    op4.innerHTML = questions[questionIndex].option4;
    console.log("questions")
  }
  ----------------------------------------------------------------l;l;
  let questionIndex = 0;
let index = 0;
var questions = [];

//Ajax call
  $.ajax({
    url: 'http://127.0.0.1:8002/api/?format=json',
    type:'GET',
    async:true,
    dataType: "json",
    success: function(data)
     {
        questions = data ;
        randomQuestion();        
     }
  });

//displays the questions and options
function load(){
    const questionNumberSpan=document.querySelector(".question-num-value");
    const totalQuestionSpan=document.querySelector(".total-question");
    const question = document.querySelector(".question");
    const op1 = document.querySelector(".option1");
    const op2 = document.querySelector(".option2");
    const op3 = document.querySelector(".option3");
    const op4 = document.querySelector(".option4");
    totalQuestionSpan.innerHTML=questions.length;
    questionNumberSpan.innerHTML=index+1;
    question.innerHTML = questions[questionIndex].question;
    op1.innerHTML = questions[questionIndex].option1;
    op2.innerHTML = questions[questionIndex].option2;
    op3.innerHTML = questions[questionIndex].option3;
    op4.innerHTML = questions[questionIndex].option4;
    index++;
  }


  
  //check the answer with the options
  const answer = document.querySelector(".answer");
  function check(){
    
    if((questions[questionIndex].option1 && questions[questionIndex].option2 && questions[questionIndex].option3 && questions[questionIndex].option4) == questions[questionIndex].correct_answer)
    {
      
    }  
    else{
           questions.classList.add("correct");

    }
  }
 
  function check(element){  
    var element = (questions[questionIndex].option1);
    if(element == questions[questionIndex].correct_answer){

    }
    else{
      element.add("correct");
    }
  }

  function randomQuestion(){
    // let randomNumber=Math.floor(Math.random()*questions.length);
    // questionIndex=randomNumber;
    console.log(questionIndex);
    load();
  }
  
 function check(radio) {
  resetColor();
    if (radio.checked) {
      if (questions[currentQuestion].correct_answer == radio.value) {
        radio.parentNode.style.backgroundColor = "green";
      } else {
        radio.parentNode.style.backgroundColor = "red";
      }
    } else {
      radio.parentNode.style.backgroundColor = "white";
    }
  }
  function showCorrect() {
  let options = document.querySelectorAll("input[name=option]");
  for (let i = 0; i < options.length; ++i) {
    if (parseInt(options[i].value) === Answers[CurrentQuestion - 1]) {
      options[i].parentNode.style.backgroundColor = "green";
    }
    options[i].setAttribute("disabled", "true");
  }
}
----------------------------------------


function check(radio) {
  resetColor();
    if (radio.checked) {
      if (questions[currentQuestion].correct_answer == radio.value) {
        radio.parentNode.style.backgroundColor = "green";
      } else {
        radio.parentNode.style.backgroundColor = "red";
      }
    } else {
      radio.parentNode.style.backgroundColor = "white";
    }
  }
  
  
  function resetColor() {
    let options = document.querySelectorAll("input[name=option]");
    for (let i = 0; i < options.length; ++i) {
      options[i].parentNode.style.background = "none";
    }
  }
//



var questions = [];
  $.ajax({
    url: 'http://127.0.0.1:8000/api2/?format=json',
    type:'GET',
    async:true,
    dataType: "json",
    success: function(data)
     {
        questions = data ;
        loadQuestion();
        
     }
});



//------------------------------------------
  var currentQuestion = 0;
  var score = 0;
  var totQuestions = 8;
  var AnswerOption = null;
  
  function loadQuestion() 
  {
    resetColor();
    enableAll();
    //questionIndex = 0
    var questionEl = document.getElementById("question");
    var opt1 = document.getElementById("opt1");
    var opt2 = document.getElementById("opt2");
    var opt3 = document.getElementById("opt3");
    var opt4 = document.getElementById("opt4");
  
    questionEl.innerHTML = (currentQuestion + 1) + '. ' + questions[currentQuestion].question;
    opt1.innerHTML = questions[currentQuestion].option1;
    opt2.innerHTML = questions[currentQuestion].option2;
    opt3.innerHTML = questions[currentQuestion].option3;
    opt4.innerHTML = questions[currentQuestion].option4;
    
    if(1 == parseInt(questions[currentQuestion].answer)) AnswerOption = opt1;
    if(2 == parseInt(questions[currentQuestion].answer)) AnswerOption = opt2;
    if(3 == parseInt(questions[currentQuestion].answer)) AnswerOption = opt3;
    if(4 == parseInt(questions[currentQuestion].answer)) AnswerOption = opt4;
  } 
  
  //--------------------------------------------------------------------------
  function loadNextQuestion() {
    resetColor();
    enableAll();
    var selectedOption = document.querySelector('input[type=radio]:checked');
    if (!selectedOption) {
      alert('Please select your answer!');
      return;
    }
    var answer = selectedOption.value;
    if (questions[currentQuestion].answer == answer) {
      score += 10;
    }
  
    selectedOption.checked = false;
    currentQuestion++;
  
    var nextButton = document.getElementById('nextButton');
    if (currentQuestion == totQuestions - 1) {
      nextButton.innerHTML = 'Finish';
    }
  
    var container = document.getElementById('quizContainer');
    var resultCont = document.getElementById('result');
    if (currentQuestion == totQuestions) {
      container.style.display = 'none';
      resultCont.style.display = '';
      console.log(score);
      if(score == 0 || score < 40)
      {
          /*status.style.display = '';*/
          resultCont.innerHTML = 'Your Score: ' + score + '/80' + '<br>' + 
          'You are failed.Try next time!!'+'<br>' +
           '<a href ="/">Home</a>' + '<br>' + '<div class="fb-share-button" data-href="https://herokuapp.quiz_django1.com/" data-layout="button_count" data-size="large"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>';
         /* status.innerHTML = "You are failed . Try next time !!";*/
      }
      else {
        /*status.style.display = '';*/
        resultCont.innerHTML = 'Your Score: ' + score + '/80' + 
        '<br>' + 
        'You are passed.Try next time!!'+
        '<br>' + '<a href ="/">Home</a>'+ 
        '<br>' + '<div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-size="large"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>' ;
        /*status.innerHTML = "You are Passed ";*/
    }

      return;
    }
    
  
    loadQuestion(currentQuestion);
  }
  
  //-------------------------------------------------------------------------------
  function check() {
    resetColor();
    var selectedOption = document.querySelector('input[type=radio]:checked');
    if (selectedOption == AnswerOption) {
      selectedOption.parentNode.style.backgroundColor = "green";
      nextButton.innerHTML = 'Next';

    } else {
      selectedOption.parentNode.style.backgroundColor = "red";
      AnswerOption.parentNode.style.backgroundColor = "green";
      nextButton.innerHTML = 'Next';

    }
    disableAll();
    showNextButton();
  }
  
  //------------------------------------------------------------------------
  function disableAll(){
    let options = document.querySelectorAll("input[type=radio]");
    for(let i = 0; i < options.length; ++i){
      options[i].setAttribute("disabled","true");
    }
  }
  
  //-----------------------------------------------------------------
  function enableAll(){
    let options = document.querySelectorAll("input[type=radio]");
    for(let i = 0; i < options.length; ++i){
      options[i].removeAttribute("disabled");
    }
  }
  
  //----------------------------------------------------------
  function resetColor(){
    let options = document.querySelectorAll("input[type=radio]");
    for(let i = 0; i < options.length; ++i){
      options[i].parentNode.style.background = "none";
      nextButton.innerHTML = '';
      nextButton.style.display = "block";


    }
  }
  
  
  loadQuestion(currentQuestion);



    /*var status = document.getElementById('status');*/
 